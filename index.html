<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>East Charlotte Christian | Login</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <b>East Charlotte Christian</b>
      <span>Season 2025–26 • Coach Wayne</span>
    </div>
    <span class="badge">Grey • Maroon</span>
  </div>

  <div class="wrap">
    <div class="grid">
      <div class="card">
        <h2>Sign in</h2>
        <p class="small">Fans, parents, and college coaches can create an account. Film is visible after login.</p>
        <div class="split">
          <div>
            <label class="small">Email</label>
            <input id="email" type="email" placeholder="email@example.com"/>
          </div>
          <div>
            <label class="small">Password</label>
            <input id="pass" type="password" placeholder="••••••••"/>
          </div>
        </div>
        <div class="row" style="margin-top:10px">
          <button class="btn" id="loginBtn">Login</button>
          <button class="btn2" id="signupBtn">Create account</button>
        </div>
        <p class="small" id="msg" style="margin-top:10px"></p>
      </div>

      <div class="card">
        <h2>How it works</h2>
        <div class="list">
          <div class="item"><div><b>Roster</b><span>Player names + jersey numbers</span></div><span class="pill">Public</span></div>
          <div class="item"><div><b>Stats</b><span>Final stats after game</span></div><span class="pill">Public</span></div>
          <div class="item"><div><b>Film</b><span>Post-game footage link</span></div><span class="pill">Login required</span></div>
        </div>
        <hr/>
        <p class="small">Coach Wayne will have an Admin page to add players, games, stats, and film links.</p>
      </div>
    </div>
  </div>

  <script type="module">
    import {
      auth, db,
      signInWithEmailAndPassword, createUserWithEmailAndPassword,
      onAuthStateChanged, doc, getDoc, setDoc, serverTimestamp
    } from "./firebase.js";

    const msg = document.getElementById("msg");

    async function ensureUserDoc(uid, email){
      const ref = doc(db, "users", uid);
      const snap = await getDoc(ref);
      if(!snap.exists()){
        // default role: fan
        await setDoc(ref, {
          email,
          role: "fan",
          approved: true,
          createdAt: serverTimestamp()
        });
      }
    }

    document.getElementById("loginBtn").onclick = async () => {
      msg.textContent = "";
      const email = document.getElementById("email").value.trim();
      const pass  = document.getElementById("pass").value.trim();
      try{
        const res = await signInWithEmailAndPassword(auth, email, pass);
        await ensureUserDoc(res.user.uid, email);
        window.location.href = "app.html";
      }catch(e){
        msg.textContent = e.message;
      }
    };

    document.getElementById("signupBtn").onclick = async () => {
      msg.textContent = "";
      const email = document.getElementById("email").value.trim();
      const pass  = document.getElementById("pass").value.trim();
      try{
        const res = await createUserWithEmailAndPassword(auth, email, pass);
        await ensureUserDoc(res.user.uid, email);
        window.location.href = "app.html";
      }catch(e){
        msg.textContent = e.message;
      }
    };

    onAuthStateChanged(auth, (user)=>{
      if(user) window.location.href = "app.html";
    });
  </script>
</body>
</html>

